# 故事一致性检查（Checklist + 示例）

本文件用于做一致性 Gate：当需要验证章节/段落是否与既有设定、已写内容一致时，按下列清单扫描并输出 Gate Report。

> 说明：本文件内容移植自上游一致性检查器思路，并已按 Novelaire 的目录与工作流做了适配（不包含后台“自动监控”、也不依赖 `/write` `/track` 等命令）。

---

## 本检查关注什么

### 角色一致性

- **物理特征**：眼睛颜色、身高、年龄、疤痕
- **性格**：行动符合已建立的角色
- **知识**：角色只知道他们应该知道的
- **成长**：变化与角色弧线一致

### 世界规则

- **系统（魔法/科技/权力体系）**：规则的使用一致，成本/代价/例外一致应用
- **地理**：距离和地点保持稳定
- **社会规则**：文化和习俗不矛盾
- **物理法则**：已建立的规则不随机打破

### 时间线逻辑

- **事件顺序**：A 在逻辑上发生在 B 之前
- **时间流逝**：角色适当地老化，康复/怀孕/训练等需要时间
- **同时事件**：多 POV 时间线对齐
- **历史一致性**：过去的引用保持一致

---

## 建议的检查信息源（按需）

一致性 Gate 运行时，优先交叉参考：
1. `spec/characters/` 角色档案与约束
2. `spec/world/` 世界事实与制度约束
3. `spec/system/` 系统规则（边界/代价/例外）
4. `spec/timeline/` 时间锚点与顺序约束
5. 既有 `chapters/` 与当前待检查文本

---

## 当检测到问题时：输出格式（示例）

当检测到潜在不一致时，建议用下面方式写入 Gate Report 的 findings：

```
问题：角色特征不匹配
位置：第 12 章，第 3 段（或：chapters/chapter_12.md:行号）
参考：spec/characters/mary.md（眼睛颜色：蓝色）

当前文本："玛丽的绿色眼睛眯起..."
已建立特征："眼睛颜色：蓝色"

可能的解决方案：
1. 将当前文本改为"蓝色眼睛"
2. 如果你要修改设定，更新 spec/characters/ 对应条目（并形成版本点）
3. 这是一个同名/相似名的不同角色？需要在设定中消歧
```

### 严重程度建议

| 级别 | 行动 | 示例 |
|------|------|------|
| **FAIL（关键）** | 阻塞下游推进，必须先修 | 角色突然知道他们不应该知道的核心秘密；系统规则被破坏导致主线逻辑不可闭合 |
| **WARN（警告）** | 可继续但必须登记待修 | 角色惯常言语模式突变；旅行时间和既定距离不匹配但可通过补一句时间跳跃修正 |
| **NOTE（注意）** | 不阻塞，仅优化 | 节奏压缩导致“时间感”偏弱，需要补 1–2 个时间锚点 |

---

## 检查严格程度（可选口径）

你可以在这次检查中明确严格程度：

**严格模式**（更偏现实/历史）：
- 标记所有矛盾
- 真实世界物理优先
- 时间线必须完全合乎逻辑

**灵活模式**（更偏奇幻/科幻）：
- 允许“酷炫规则”例外（但必须有约束与代价）
- 允许艺术许可，但要显式标记并保持一致

**最小模式**：
- 只标记关键矛盾
- 专注于角色状态与主要情节点

---

## 常见“误报”与例外（如何处理）

### 有意的矛盾

**示例**：角色谎报眼睛颜色  
**处理**：在设定里标注“对外宣称”的口径与真实口径（避免后续反复报错）。

### 不可靠的叙述者

**示例**：第一人称叙述者记错事件  
**处理**：在叙事/风格约束中写清楚“不可靠叙述者是刻意策略”，并为关键矛盾提供读者可感知的提示。

### 时间跳跃

**示例**：角色年龄突然增加  
**处理**：在章节中明确时间跳跃（“三年后…”），并确保时间线锚点同步更新。

---

## 最佳实践

### 保持设定文档更新

一致性检查只能和设定一样好：
- 特征变化时更新 `spec/characters/`
- 清楚记录世界规则 `spec/world/` 与系统规则 `spec/system/`
- 维护时间锚点 `spec/timeline/`

### 及时处理问题，避免累积

- 关键矛盾优先修复（FAIL）
- WARN 允许延后，但要登记并在下一次回归中验证
- NOTE 可以批量优化

---

## 检查类别详解（可作为逐项扫描清单）

### 角色一致性检查

**物理描述**
```
✓ 身高、体重、年龄、发色、眼色
✓ 疤痕、纹身、独特标记
✓ 服装风格、配饰
```

**行为模式**
```
✓ 言语模式是否一致
✓ 反应是否符合性格
✓ 决策是否符合价值观
✓ 技能/能力是否一致
```

**知识状态**
```
✓ 角色“知道什么时候知道的”
✓ 不知道不应该知道的秘密
✓ 记忆与已建立事实一致
```

### 世界规则检查

**系统（魔法/科技/权力）**
```
✓ 规则在已建立限制内使用
✓ 代价/成本一致应用
✓ 规则不为了情节便利而改变
✓ 例外有前期暗示，且不会破坏整体约束
```

**地理和距离**
```
✓ 地点在地图/描述中保持一致
✓ 旅行时间合理
✓ 气候与地理匹配
✓ 地标不“移动”
```

**社会和文化**
```
✓ 文化规范一致
✓ 语言和方言保持稳定
✓ 社会结构不随机改变
✓ 宗教/信仰保持一致
```

### 时间线检查

**事件序列**
```
✓ 原因发生在结果之前
✓ 角色不在他们不能在的地方
✓ 事件在合理的时间范围内发生
```

**时间流逝**
```
✓ 角色适当地老化
✓ 季节按顺序改变（若 relevant）
✓ 怀孕/康复需要时间
✓ 技能习得需要练习时间
```

**多 POV 同步**
```
✓ 同时事件从不同 POV 匹配
✓ 时间跳跃在 POV 之间对齐
✓ 没有 POV 知道其他 POV 的未来
```

---

## 修复建议（仅提供候选，不自动改）

本 Gate 可以提供“候选修复方案”，但默认不直接改正文（除非你明确要求）。

**名字/拼写不一致**
- 建议：选定一个标准写法，全局统一

**数字不一致**
- 建议：以时间线与设定为准，统一数字；必要时补一句解释（时间跳跃/误记/谎言）

**时间线冲突**
- 建议：调整事件顺序或补足过渡（时间跳跃、旅行耗时、训练/恢复耗时）

---

## 里程碑报告（示例模板）

```markdown
## Consistency Gate Report - [日期]

### 范围：第 1–15 章

### 结果：WARN

### Findings

#### FAIL（必须修复）
1. 第 12 章：角色知道只在第 14 章揭示的信息
   - 建议：重写第 12 章场景或将第 14 章揭示前置；并更新相应的知情边界条目

#### WARN（应修复）
1. 第 8 章：角色眼睛颜色从蓝色变为绿色
   - 建议：统一为蓝色；或在设定中解释“佩戴隐形眼镜/伪装”的规则

2. 第 10 章：从首都到边境的旅行只用了 1 天（此前设定为 3 天）
   - 建议：添加时间跳跃或调整天数；并确保后续不再破坏旅行耗时约束

#### NOTE（可优化）
1. 第 5 章：时间感偏弱，建议补 1–2 个时间锚点（昼夜/节令/具体时刻）

### 下一步
- 先修复 FAIL 项，再决定是否继续推进下游
```

---

**核心提醒**：一致性不是为了“完美”，而是为了维持读者的信任。规则可靠，读者才会沉浸。规则随意改变，读者会出戏。你永远拥有最终决定权：如果某个“不一致”是刻意的艺术选择，把“刻意”写进设定与叙事约束即可。
